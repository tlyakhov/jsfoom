<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <title>Rays</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Rays"/>
    <meta name="keywords" content="rays />
		<meta name=" author
    " content="Tim Lyakhovetskiy" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
    <link href='http://fonts.googleapis.com/css?family=Cabin:500,500italic,700,700italic' rel='stylesheet'
          type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700' rel='stylesheet' type='text/css'>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="js/game_constants.js"></script>
    <script src="js/engine/ObjectId.js"></script>
    <script src="js/engine/utils.js"></script>
    <script src="js/engine/texture.js"></script>
    <script src="js/engine/texture_cache.js"></script>
    <script src="js/engine/material.js"></script>
    <script src="js/engine/map_segment.js"></script>
    <script src="js/engine/map_sector.js"></script>
    <script src="js/engine/map_sector_water.js"></script>
    <script src="js/engine/map_sector_vertical_door.js"></script>
    <script src="js/engine/entity.js"></script>
    <script src="js/engine/player.js"></script>
    <script src="js/engine/map.js"></script>
    <script src="js/engine/renderer.js"></script>
    <script src="js/engine/render_slice.js"></script>
    <script src="js/testmap.js"></script>
    <script src="js/input.js"></script>
</head>
<body onload="init();" onkeydown="keyDown(event);return false;" onkeyup="keyUp(event); return false;">
<canvas id="renderCanvas" width="640" height="360">
</canvas>
<script>
    var map = testmap;
    var renderer = new Renderer({ canvas: '#renderCanvas' });
    var prevTime = new Date().getTime();
    var curTime = new Date().getTime();
    var lastFrameTime = 0;

    function init() {
        var canvas = document.getElementById('renderCanvas');
        var ctx = canvas.getContext('2d');
        var imgData = ctx.createImageData(renderer.screenWidth, renderer.screenHeight);
        var renderBuffer = new ArrayBuffer(imgData.data.length);
        var renderBuffer8 = new Uint8ClampedArray(renderBuffer);
        var renderTarget = new Uint32Array(renderBuffer);

        setInterval(function () {
            curTime = new Date().getTime();
            lastFrameTime = (curTime - prevTime);
            prevTime = curTime;

            renderer.render(renderTarget);
            imgData.data.set(renderBuffer8);
            ctx.putImageData(imgData, 0, 0);

            ctx.fillStyle = '#FFF';
            ctx.fillText('FPS: ' + Math.round(1000.0 / lastFrameTime), 5, 15);
            ctx.fillText('Current sector: ' + map.player.sector.id, 5, 25);
            ctx.fillText('Health: ' + map.player.health, 5, 35);
            checkInput();

            map.frame(lastFrameTime);
        }, 1);
    }

</script>
<h1>jsFoom Test</h1>

<p>
    Controls:
<ul>
    <li>Walk Forward: <b>W</b></li>
    <li>Walk Backward: <b>S</b></li>
    <li>Turn Left: <b>A</b></li>
    <li>Turn Right: <b>D</b></li>
    <li>Jump: <b>SPACE</b></li>
    <li>Crouch: <b>C</b></li>
</ul>
</p>
</body>
</html>